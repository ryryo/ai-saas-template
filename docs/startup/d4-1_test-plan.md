# テスト計画書

本ドキュメントでは、AI-SaaS テンプレートの品質保証のためのテスト計画について説明します。

## 1. テスト戦略の概要

### 1.1 テスト目標

本テスト計画の目標は以下の通りです：

- システム要件が正しく実装されていることを確認する
- 各コンポーネントが期待通りに機能することを検証する
- システム全体の品質と信頼性を確保する
- ユーザーエクスペリエンスが要件を満たしていることを確認する
- セキュリティ上の脆弱性がないことを確認する
- パフォーマンスが要件を満たしていることを検証する

### 1.2 テスト種類

本プロジェクトでは以下のテスト種類を実施します：

| テスト種類 | 概要 | 実施タイミング |
|----------|------|-------------|
| 単体テスト | 個々のコンポーネントやメソッドの機能検証 | 開発時、CI実行時 |
| 統合テスト | 複数のコンポーネント間の連携検証 | 開発時、CI実行時 |
| E2Eテスト | ユーザーシナリオを通したシステム全体の検証 | CI実行時、リリース前 |
| API契約テスト | API仕様と実装の整合性検証 | CI実行時 |
| パフォーマンステスト | レスポンス時間、リソース使用量の検証 | リリース前 |
| セキュリティテスト | 脆弱性と認証・認可機能の検証 | リリース前 |
| アクセシビリティテスト | UI/UXの使いやすさと標準準拠の検証 | UI実装後 |

### 1.3 テスト環境

| 環境 | 用途 | 構成 |
|------|------|------|
| 開発環境 | 開発中のテスト実行 | Docker Compose |
| CI環境 | 自動テスト実行 | GitHub Actions |
| ステージング環境 | 統合テスト、ユーザー受入テスト | 本番同等環境 |
| 本番環境 | - | Laravel Forge + クラウドプロバイダー |

## 2. テスト範囲

### 2.1 フロントエンドテスト範囲

| 分類 | 対象コンポーネント | テスト内容 |
|------|------------------|----------|
| UI コンポーネント | 共通レイアウト | レスポンシブ対応の検証、ブレイクポイントの確認 |
| | ナビゲーション | メニュー展開・折りたたみ、モバイル表示切替 |
| | フォームコンポーネント | 入力検証、送信処理、エラー表示 |
| | データテーブル | ソート、フィルタ、ページネーション機能 |
| | グラフ・チャート | データ表示、レスポンシブ対応 |
| 画面 | ログイン/認証 | 認証フロー、エラーハンドリング |
| | ダッシュボード | KPI表示、データ更新 |
| | テナント管理 | CRUD操作、権限制御、設定管理 |
| | トラッキングタグ管理 | タグ生成、配布、設定 |
| | データ分析 | グラフ表示、フィルタリング |
| 状態管理 | Pinia ストア | 状態変更、永続化、初期化 |
| ルーティング | Vue Router | ルート遷移、ガード、パラメータ処理 |

### 2.2 バックエンドテスト範囲

| 分類 | 対象 | テスト内容 |
|------|-----|----------|
| API エンドポイント | 認証API | ログイン/ログアウト、トークン発行 |
| | テナント管理API | CRUD操作、バリデーション、設定管理 |
| | トラッキングタグAPI | タグ生成、取得、更新 |
| | イベント記録API | データ受信、保存、集計 |
| | AI分析API | データ分析、レコメンデーション |
| ミドルウェア | 認証ミドルウェア | トークン検証、セッション管理 |
| | テナントスコープ | テナント分離、クエリフィルタリング |
| | レート制限 | リクエスト制限、エラーハンドリング |
| サービス層 | 認証サービス | テナント検証、権限チェック |
| | テナントサービス | テナント処理ロジック、設定管理 |
| | イベント処理サービス | データ処理、集計、分析 |
| | AI推論サービス | 外部API連携、データ処理 |
| データベース | マイグレーション | スキーマ適用、ロールバック |
| | モデル | リレーション、スコープ、ミューテータ |
| | クエリビルダ | 複雑なクエリ、パフォーマンス |

### 2.3 トラッキングタグのテスト範囲

| 分類 | 対象 | テスト内容 |
|------|-----|----------|
| クライアント実装 | タグスクリプト | ロード処理、初期化、エラーハンドリング |
| | イベントリスナー | クリック、フォーム送信、スクロールの検出 |
| | データ収集 | User-Agent、タイムスタンプ、イベント情報 |
| | データ送信 | Beacon API、XHR、エラーリトライ |
| サーバー処理 | データ受信 | リクエスト検証、不正データのフィルタリング |
| | データ処理 | 正規化、集計、保存 |
| | 分析処理 | リアルタイム集計、バッチ処理 |
| クロスブラウザ | 主要ブラウザ | Chrome、Firefox、Safari、Edgeでの動作 |
| | モバイルブラウザ | iOS Safari、Android Chromeでの動作 |

## 3. テストケース

### 3.1 認証・認可テストケース

| ID | テストケース | 前提条件 | テストステップ | 期待結果 |
|----|------------|---------|--------------|---------|
| AUTH-01 | 有効な認証情報でのログイン | 有効なユーザーが存在する | 1. ログイン画面にアクセス<br>2. 有効なメールアドレスとパスワードを入力<br>3. ログインボタンをクリック | ダッシュボードにリダイレクトされ、ユーザー情報が表示される |
| AUTH-02 | 無効な認証情報でのログイン | - | 1. ログイン画面にアクセス<br>2. 無効なメールアドレスとパスワードを入力<br>3. ログインボタンをクリック | エラーメッセージが表示され、ログイン状態にならない |
| AUTH-03 | ログアウト処理 | ログイン済み | 1. ログアウトボタンをクリック | ログイン画面にリダイレクトされ、保護されたページにアクセスできない |
| AUTH-04 | アクセス権限の検証 | ログイン済み | 1. 権限のないページにアクセスを試みる | 403エラーまたは権限エラーページが表示される |
| AUTH-05 | APIトークン認証 | 有効なAPIトークンが発行されている | 1. トークンを使用してAPI要求を送信 | 正常なレスポンスが返される |
| AUTH-06 | APIトークン失効 | 失効したトークン | 1. 失効したトークンでAPI要求を送信 | 401エラーが返される |

### 3.2 テナント管理テストケース

| ID | テストケース | 前提条件 | テストステップ | 期待結果 |
|----|------------|---------|--------------|---------|
| TENANT-01 | テナント作成 | スーパー管理者でログイン済み | 1. テナント管理画面にアクセス<br>2. 「新規作成」ボタンをクリック<br>3. テナント情報を入力<br>4. 保存ボタンをクリック | テナントが作成され、リストに表示される |
| TENANT-02 | テナント編集 | スーパー管理者でログイン済み、テナントが存在する | 1. テナント一覧から編集対象を選択<br>2. 情報を変更<br>3. 保存ボタンをクリック | テナント情報が更新される |
| TENANT-03 | テナント削除 | スーパー管理者でログイン済み、テナントが存在する | 1. テナント一覧から削除対象を選択<br>2. 削除ボタンをクリック<br>3. 確認ダイアログで確認 | テナントが削除され、リストから消える |
| TENANT-04 | テナント設定管理 | テナント管理者でログイン済み | 1. テナント設定画面にアクセス<br>2. 設定を変更<br>3. 保存ボタンをクリック | 設定が更新され、反映される |
| TENANT-05 | プラン変更 | スーパー管理者でログイン済み | 1. テナント詳細画面でプラン変更<br>2. 新プランを選択<br>3. 保存ボタンをクリック | プランが変更され、機能制限が更新される |
| TENANT-06 | パスワード変更 | テナント管理者でログイン済み | 1. プロフィール画面にアクセス<br>2. パスワード変更フォームに入力<br>3. 保存ボタンをクリック | パスワードが変更され、新パスワードでログイン可能になる |
| TENANT-07 | メールアドレス変更 | テナント管理者でログイン済み | 1. プロフィール画面にアクセス<br>2. メールアドレス変更フォームに入力<br>3. 保存ボタンをクリック | メールアドレスが変更され、新アドレスで認証可能になる |

### 3.3 トラッキングタグテストケース

| ID | テストケース | 前提条件 | テストステップ | 期待結果 |
|----|------------|---------|--------------|---------|
| TAG-01 | タグ作成 | ログイン済み | 1. タグ管理画面にアクセス<br>2. 「新規作成」ボタンをクリック<br>3. タグ情報を入力<br>4. 保存ボタンをクリック | タグが作成され、一意のIDが生成される |
| TAG-02 | タグコード取得 | タグが存在する | 1. タグ詳細画面にアクセス<br>2. 「コード表示」ボタンをクリック | 設置用JavaScriptコードが表示される |
| TAG-03 | タグの有効化/無効化 | タグが存在する | 1. タグ詳細画面で状態を切り替え<br>2. 保存ボタンをクリック | タグの状態が変更され、イベント収集に影響する |
| TAG-04 | タグ設置検証 | タグが存在し、コードを取得済み | 1. テスト用Webページにコードを設置<br>2. ページを表示しイベントを発生させる | イベントが記録される |
| TAG-05 | 無効なタグキーの検証 | - | 1. 無効なタグキーでイベントを送信 | エラーが返され、イベントが記録されない |

### 3.4 イベント記録テストケース

| ID | テストケース | 前提条件 | テストステップ | 期待結果 |
|----|------------|---------|--------------|---------|
| EVENT-01 | クリックイベント記録 | タグが設置されたページ | 1. CTA要素をクリック | イベントが記録され、ダッシュボードに反映される |
| EVENT-02 | ページビューイベント記録 | タグが設置されたページ | 1. ページを読み込む | ページビューイベントが記録される |
| EVENT-03 | カスタムイベント記録 | タグが設置され、カスタムイベントが設定されたページ | 1. カスタムイベントをトリガーする操作を実行 | カスタムイベントが記録される |
| EVENT-04 | 大量イベント処理 | タグが設置されたページ | 1. 短時間に多数のイベントを発生させる | すべてのイベントが正確に記録される |
| EVENT-05 | オフライン時の動作 | タグが設置されたページ | 1. ネットワーク接続を切断<br>2. イベントを発生させる<br>3. 接続を復旧 | 接続復旧後にイベントが送信される |

### 3.5 データ分析・AIテストケース

| ID | テストケース | 前提条件 | テストステップ | 期待結果 |
|----|------------|---------|--------------|---------|
| AI-01 | 基本分析実行 | イベントデータが存在する | 1. 分析画面にアクセス<br>2. 分析パラメータを設定<br>3. 「分析実行」ボタンをクリック | 分析ジョブが開始され、結果が表示される |
| AI-02 | AI提案生成 | 十分なイベントデータが存在する | 1. AI提案画面にアクセス<br>2. 「提案生成」ボタンをクリック | CTA最適化の提案が生成される |
| AI-03 | 分析期間指定 | イベントデータが存在する | 1. 分析画面で期間を指定<br>2. 「分析実行」ボタンをクリック | 指定期間のデータのみを対象に分析が実行される |
| AI-04 | フィルタ適用分析 | イベントデータが存在する | 1. 分析画面でフィルタを適用<br>2. 「分析実行」ボタンをクリック | フィルタ条件に合致するデータのみを対象に分析が実行される |
| AI-05 | エクスポート機能 | 分析結果が存在する | 1. 分析結果画面で「エクスポート」ボタンをクリック | 分析結果がCSV形式でダウンロードされる |

### 3.6 パフォーマンステストケース

| ID | テストケース | 前提条件 | テストステップ | 期待結果 |
|----|------------|---------|--------------|---------|
| PERF-01 | ページロード時間 | - | 1. 各主要ページのロード時間を計測 | 2秒以内（95パーセンタイル） |
| PERF-02 | API応答時間 | - | 1. 各主要APIエンドポイントの応答時間を計測 | 300ms以内（95パーセンタイル） |
| PERF-03 | 同時ユーザー処理 | - | 1. 複数の同時ユーザーでのアクセスをシミュレート | システムが正常に動作し続ける |
| PERF-04 | イベント高負荷処理 | - | 1. 短時間に多数のイベントを送信 | すべてのイベントが正確に処理される |
| PERF-05 | DB処理性能 | 大量のデータが存在する | 1. 複雑なクエリのレスポンス時間を計測 | 500ms以内に完了する |

## 4. テスト環境と実行方針

### 4.1 単体テスト

| 分類 | 技術スタック | 対象 |
|------|------------|------|
| バックエンド | PHPUnit | コントローラー、サービス、モデル |
| フロントエンド | Jest, Vue Test Utils | コンポーネント、ストア、ユーティリティ |

### 4.2 統合テスト

| 分類 | 技術スタック | 対象 |
|------|------------|------|
| バックエンド | PHPUnit, Laravel TestCase | API、ミドルウェア、データベース操作 |
| フロントエンド | Cypress (Component Tests) | 複合コンポーネント、画面 |

### 4.3 E2Eテスト

| 分類 | 技術スタック | 対象 |
|------|------------|------|
| ブラウザテスト | Cypress | ユーザージャーニー、クリティカルパス |
| API契約テスト | Postman/Newman | APIエンドポイント全体 |

### 4.4 パフォーマンステスト

| 分類 | 技術スタック | 対象 |
|------|------------|------|
| 負荷テスト | k6 | API、バックエンド処理 |
| フロントエンド計測 | Lighthouse | ウェブパフォーマンス指標 |

## 5. 受入基準

### 5.1 機能要件の受入基準

以下の条件をすべて満たす必要があります：

1. すべての機能テストケースが成功すること
2. クリティカルなユーザーフローがエラーなく完了すること
3. 各ユーザーロールの権限が正しく機能していること
4. すべてのCRUD操作が正常に動作すること
5. マルチテナント構造が正しく機能し、データ分離が保たれていること
6. トラッキングタグが期待通りに機能し、イベントが正確に記録されること
7. AI提案機能が期待通りの出力を生成すること

### 5.2 非機能要件の受入基準

以下の条件をすべて満たす必要があります：

1. **パフォーマンス**
   - ページロード時間が2秒以内（95パーセンタイル）
   - API応答時間が300ms以内（95パーセンタイル）
   - 同時100ユーザーのアクセスを処理可能

2. **セキュリティ**
   - OWASP Top 10の脆弱性がないこと
   - 適切な認証・認可メカニズムが実装されていること
   - データが暗号化されて保存・転送されること

3. **ユーザビリティ**
   - すべての主要画面がモバイルデバイスで正常に表示・機能すること
   - WCAG 2.1 AA準拠のアクセシビリティ
   - 主要ブラウザ（Chrome、Firefox、Safari、Edge最新版）で正常に動作すること

4. **信頼性**
   - システム稼働率99.9%以上
   - データ損失がないこと
   - エラー発生時に適切なメッセージが表示されること

### 5.3 コード品質の受入基準

以下の条件をすべて満たす必要があります：

1. コードスタイルガイドラインに準拠していること
2. 単体テストカバレッジ80%以上
3. 静的解析ツールで重大な問題が検出されないこと
4. すべてのCIパイプラインが成功すること
5. コードレビューで承認されていること

### 5.4 ドキュメントの受入基準

以下のドキュメントが完成し、正確であること：

1. セットアップガイド
2. API仕様書
3. ユーザーマニュアル
4. 管理者ガイド
5. コンポーネントスタイルガイド

## 6. バグ分類と優先度

| 優先度 | 説明 | 対応期限 |
|-------|------|---------|
| クリティカル | システム全体の機能停止やデータ損失を引き起こす問題 | 即時対応（24時間以内） |
| 高 | 主要機能が使用できない、または重大な問題がある | 48時間以内 |
| 中 | 機能の一部が正常に動作しない | 1週間以内 |
| 低 | 軽微な問題、UI調整など | 計画的に対応 |

## 7. テスト成果物

| 成果物 | 説明 | 責任者 |
|-------|------|-------|
| テスト計画書 | 本ドキュメント | テストマネージャー |
| テストケース | 詳細なテスト手順と期待結果 | テストエンジニア |
| テスト実行結果 | テスト実行の結果と発見された問題 | テストエンジニア |
| バグレポート | 発見された問題の詳細記録 | テストエンジニア |
| テスト完了レポート | 全テスト結果のサマリーと品質評価 | テストマネージャー |

## 8. テストスケジュール

| フェーズ | 期間 | 活動 |
|---------|------|------|
| テスト計画 | 1週間 | テスト計画書作成、テストケース設計 |
| 単体テスト | 開発と並行 | 各コンポーネントの単体テスト実施 |
| 統合テスト | 2週間 | コンポーネント間連携のテスト |
| システムテスト | 2週間 | システム全体のテスト、非機能要件テスト |
| ユーザー受入テスト | 1週間 | 実際のユーザーによるテスト |
| 回帰テスト | 必要に応じて | バグ修正後の再テスト | 